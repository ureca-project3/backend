<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>트리플민수</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            display: flex; /* 플렉스박스를 사용하여 배너와 제목을 정렬 */
            align-items: center; /* 수직 중앙 정렬 */
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
        }
        header img {
            width: 100px; /* 배너 이미지의 너비 조절 */
            height: auto; /* 비율에 맞춰 높이 자동 조절 */
            margin-right: 20px; /* 이미지와 제목 간의 여백 */
        }
        nav {
            margin: 20px;
            text-align: center;
        }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: #007bff;
            font-weight: bold;
        }
        nav a:hover {
            text-decoration: underline;
        }
        footer {
            text-align: center;
            margin: 20px 0;
            font-size: 0.8em;
            color: #777;
        }
        .logout-button {
            background-color: #dc3545; /* 빨간색 배경 */
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            margin-left: auto; /* 오른쪽 정렬 */
        }
        .logout-button:hover {
            background-color: #c82333; /* 어두운 빨간색 */
        }
        #user-info {
            margin-left: auto;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<header>
    <a href="/index.html">
        <img src="/image/1.jpg" alt="사이트 배너"> <!-- 수정된 경로 -->
    </a>
    <h1>트리플민수</h1>
    <div id="user-info">로그인되지 않았습니다</div> <!-- 로그인되지 않았을 때 표시될 기본 메시지 -->
    <button class="logout-button" id="logout-button" style="display: none;">로그아웃</button>
</header>

<nav>
    <a href="/login.html">로그인</a>
    <a href="/signup.html">회원가입</a>
    <a href="/mypage.html">마이페이지</a>
</nav>

<footer>
    <p>&copy; 2024 트리플민수. Even하게 익히다.</p>
</footer>

<script>
    // 로그인 상태 확인 및 사용자 정보 표시
    const accessToken = localStorage.getItem('accessToken'); // 또는 세션에서 가져옴
    const userInfoDiv = document.getElementById('user-info');
    const logoutButton = document.getElementById('logout-button');

    if (accessToken) {
        console.log('Access Token:', accessToken); // Access Token 확인

        // 토큰이 JWT 형식인지 검사 (기본적으로 '.'이 2개 있는지 확인)
        if (accessToken.split('.').length === 3) {
            try {
                const base64Url = accessToken.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                const userPayload = JSON.parse(jsonPayload);
                console.log('User Payload:', userPayload); // Payload 출력

                const email = userPayload.email;
                const role = userPayload.role;

                if (email && role) {
                    userInfoDiv.innerText = `이메일: ${email}, 역할: ${role}`;
                    logoutButton.style.display = 'inline-block'; // 로그아웃 버튼 표시
                } else {
                    console.error('유효한 이메일 또는 역할 정보가 없습니다.');
                    userInfoDiv.innerText = '정보를 표시할 수 없습니다';
                }
            } catch (error) {
                console.error('JWT 디코딩 오류:', error); // 오류 발생 시 로그 출력
                userInfoDiv.innerText = '정보를 표시할 수 없습니다'; // 오류 발생 시 표시
            }
        } else {
            console.error('JWT 형식이 유효하지 않습니다.');
            userInfoDiv.innerText = '로그인되지 않았습니다';
        }
    } else {
        console.log('Access Token 없음');
        userInfoDiv.innerText = '로그인되지 않았습니다'; // 로그인되지 않았을 때 표시
    }


    // 로그아웃 버튼 클릭 이벤트
    logoutButton.addEventListener('click', function() {
        fetch('/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // 필요한 경우 인증 헤더 추가
                // 'Authorization': `Bearer ${accessToken}`
            }
        })
            .then(response => {
                if (response.ok) {
                    localStorage.removeItem('accessToken'); // accessToken 삭제
                    alert('로그아웃 성공');
                    window.location.reload(); // 페이지 새로고침
                } else {
                    alert('로그아웃 실패');
                }
            })
            .catch(error => {
                console.error('로그아웃 중 오류 발생:', error);
            });
    });
</script>

</body>
</html>
